"use strict";(self.webpackChunktoken_minter=self.webpackChunktoken_minter||[]).push([[485],{70485:function(n,t,r){r.r(t),r.d(t,{StrikeWallet:function(){return d}});var e=r(24611),i=r(53755),a=r(19961),s=r(47061),o=r(59900),c=r(29325),u=r(42933),l=r(57604),p=Buffer.alloc(c.SIGNATURE_LENGTH_IN_BYTES).fill(0),d=function(){function n(){var t=this;(0,s.Z)(this,n),this.url="https://wallet.strikeprotocols.com",this.cleanUp=function(){(0,a.Z)(t._timers).forEach((function(n){return t.clearTimer(n)}));var n=t._wallet;n&&n.close(),t._wallet=null},this.clearTimer=function(n){t._timers=t._timers.filter((function(t){return t!=n})),window.clearInterval(n)},this.instructionsToSerializableInstructions=function(n){return n.map((function(n){return{programId:n.programId.toBase58(),accountMetas:n.keys.map((function(n){return{address:n.pubkey.toBase58(),signer:n.isSigner,writable:n.isWritable}})),data:window.btoa(String.fromCharCode.apply(String,(0,a.Z)(n.data)))}}))},this.handleWalletMessage=function(n){var r,e,i;if("connected"==n.type)t._connecting=!1,n.error||(t.isLoggedIn=!0,(null===(r=n.connected)||void 0===r?void 0:r.publicKey)&&(t._publicKey=new c.PublicKey(n.connected.publicKey)));else if(["sendTransaction","sendFinalTransaction"].includes(n.type)){var a=null===(e=n.sendTransaction)||void 0===e?void 0:e.identifier;a&&a in t._pendingTransactions&&(n.error?t._pendingTransactionErrors[a]=new Error(n.error):t._pendingTransactions[a]=n.sendTransaction||null)}else if("signTransaction"==n.type){var s=null===(i=n.signTransaction)||void 0===i?void 0:i.identifier;s&&s in t._pendingTransactions&&(n.error?t._pendingTransactionErrors[s]=new Error(n.error):t._pendingTransactions[s]=n.signTransaction||null)}},this.isLoggedIn=!1,this._pendingTransactions={},this._pendingTransactionErrors={},this._timers=[],this._wallet=null,this._connecting=!1,this._publicKey=null,window.addEventListener("message",(function(n){t.handleWalletMessage(n.data)}))}return(0,o.Z)(n,[{key:"connect",value:function(){var n=(0,i.Z)((0,e.Z)().mark((function n(t){var r,i,a=this;return(0,e.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,this.url=t||this.url,r=encodeURIComponent(window.location.origin),i="".concat(this.url,"/connect?origin=").concat(r),this._connecting=!0,this._wallet=window.open(i,"strike-wallet-".concat(r),"height=800,width=800,menubar=no,status=no,toolbar=no"),this._wallet){n.next=9;break}throw this._connecting=!1,new Error("Unable to connect to wallet");case 9:return this._timers.push(window.setInterval((function(){a._wallet.closed?a.cleanUp():a._wallet&&a._wallet.postMessage({type:"heartbeat"},a.url)}),100)),n.abrupt("return",new Promise((function(n,t){var r=window.setInterval((function(){a.isLoggedIn&&a._publicKey?(a.clearTimer(r),n(a._publicKey)):a.isLoggedIn||a._connecting||(a.clearTimer(r),t(new Error("Unable to connect to Strike")))}),100);a._timers.push(r)})));case 13:throw n.prev=13,n.t0=n.catch(0),n.t0;case 16:case"end":return n.stop()}}),n,this,[[0,13]])})));return function(t){return n.apply(this,arguments)}}()},{key:"signTransaction",value:function(){var n=(0,i.Z)((0,e.Z)().mark((function n(t){return(0,e.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.verifyCanSignRequests([t]),n.prev=1,n.abrupt("return",this.signOneTransaction(t));case 5:throw n.prev=5,n.t0=n.catch(1),n.t0;case 8:case"end":return n.stop()}}),n,this,[[1,5]])})));return function(t){return n.apply(this,arguments)}}()},{key:"signAllTransactions",value:function(){var n=(0,i.Z)((0,e.Z)().mark((function n(t){var r=this;return(0,e.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.verifyCanSignRequests(t),n.prev=1,n.abrupt("return",Promise.all(t.map((function(n){return r.signOneTransaction(n)}))));case 5:throw n.prev=5,n.t0=n.catch(1),n.t0;case 8:case"end":return n.stop()}}),n,this,[[1,5]])})));return function(t){return n.apply(this,arguments)}}()},{key:"sendTransaction",value:function(){var n=(0,i.Z)((0,e.Z)().mark((function n(t,r,i){var s,o,c,u,p=this;return(0,e.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,s=this._wallet){n.next=4;break}throw new Error("Not Connected");case 4:if(o=(0,l.Z)(),this._pendingTransactions[o]=null,!((c=i?i.signers:void 0)&&c.length>0)){n.next=11;break}return n.abrupt("return",new Promise((function(n,r){p.signOneTransaction(t,o).then((function(t){p._pendingTransactions[o]=null,(null===c||void 0===c?void 0:c.length)&&t.partialSign.apply(t,(0,a.Z)(c)),s.postMessage({type:"sendFinalTransaction",sendFinalTransaction:{transactionIdentifier:o,signaturePubkeyPairs:t.signatures.filter((function(n){return null!=n.signature})).map((function(n){return{pubkey:n.publicKey.toBase58(),signature:n.signature.toString("base64")}}))}},p.url);var e=window.setInterval((function(){var t=p._pendingTransactions[o],i=p._pendingTransactionErrors[o];null==t&&null==i||(p.clearTimer(e),t&&n(t.signature),i&&r(i))}),100);p._timers.push(e)})).catch((function(n){throw r(n),n}))})));case 11:return u=this.instructionsToSerializableInstructions(t.instructions),n.abrupt("return",new Promise((function(n,t){s.postMessage({type:"sendTransaction",sendTransaction:{instructions:u,transactionIdentifier:o}},p.url);var r=window.setInterval((function(){var e=p._pendingTransactions[o],i=p._pendingTransactionErrors[o];null==e&&null==i||(p.clearTimer(r),e&&n(e.signature),i&&t(i))}),100);p._timers.push(r)})));case 13:n.next=18;break;case 15:throw n.prev=15,n.t0=n.catch(0),n.t0;case 18:case"end":return n.stop()}}),n,this,[[0,15]])})));return function(t,r,e){return n.apply(this,arguments)}}()},{key:"buildTransaction",value:function(n){var t=c.Message.from(Buffer.from(Uint8Array.from(window.atob(n.message),(function(n){return n.charCodeAt(0)}))));return c.Transaction.populate(t,Array.from({length:t.header.numRequiredSignatures},(function(r,e){var i=n.signatures.find((function(n){return n.pubkey==t.accountKeys[e].toBase58()}));return u.encode(i?Buffer.from(Uint8Array.from(window.atob(i.signature),(function(n){return n.charCodeAt(0)}))):p)})))}},{key:"verifyCanSignRequests",value:function(n){n.forEach((function(n){if(n.signatures.some((function(n){return null!=n.signature})))throw new Error("Strike does not support this signing mode")}))}},{key:"signOneTransaction",value:function(n){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,l.Z)(),e=this._wallet;if(!e)throw new Error("Not Connected");var i=this.instructionsToSerializableInstructions(n.instructions);return this._pendingTransactions[r]=null,new Promise((function(n,a){e.postMessage({type:"signTransaction",signTransaction:{instructions:i,transactionIdentifier:r}},t.url);var s=window.setInterval((function(){var e=t._pendingTransactions[r],i=t._pendingTransactionErrors[r];null==e&&null==i||(t.clearTimer(s),e&&n(t.buildTransaction(e)),i&&a(i))}),100);t._timers.push(s)}))}}]),n}()}}]);
//# sourceMappingURL=485.6ffd57c8.chunk.js.map